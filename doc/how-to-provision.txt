How to test provisioning?

1
macmini@Macmini ~ % brew install bazelisk

2
Cd ~/github/android-testdpc

macmini@Macmini android-testdpc % export ANDROID_HOME=/Users/macmini/Library/Android/sdk

macmini@Macmini android-testdpc % bazel build testdpc

3
Install Bazel for Android Studio

4
Follow instructions https://github.com/googlesamples/android-testdpc

5
# Determine your shell
echo $SHELL

# For zsh (default on modern macOS)
echo 'export ANDROID_HOME=$HOME/Library/Android/sdk' >> ~/.zshrc
echo 'export PATH=$PATH:$ANDROID_HOME/platform-tools' >> ~/.zshrc
source ~/.zshrc

# For bash
echo 'export ANDROID_HOME=$HOME/Library/Android/sdk' >> ~/.bash_profile
echo 'export PATH=$PATH:$ANDROID_HOME/platform-tools' >> ~/.bash_profile
source ~/.bash_profile

6. Use the following command to generate the apk file:

bazel build testdpc

If the cellphone cannot be listed in Select Device, Edit Configurations , change Bazel from mobile-install to run.

7
rm -f bazel-bin/testdpc-aligned.apk

~/Library/Android/sdk/build-tools/34.0.0/zipalign -v -p 4 \
  bazel-bin/testdpc.apk \
  bazel-bin/testdpc-aligned.apk

~/Library/Android/sdk/build-tools/34.0.0/apksigner sign \
  --ks ~/github/feitian-dpc/keystore/feitiandpc2.jks \
  --ks-pass pass:CJCSLHPhhzssqg \
  --key-pass pass:CJCSLHPhhzssqg \
  --ks-key-alias feitian \
  --out bazel-bin/testdpc-signed.apk \
  bazel-bin/testdpc-aligned.apk

~/Library/Android/sdk/build-tools/34.0.0/apksigner verify -v bazel-bin/testdpc-signed.apk

~/Library/Android/sdk/build-tools/34.0.0/apksigner verify --print-certs bazel-bin/testdpc-signed.apk | grep "SHA-256 digest"  |cut -d":" -f2 | xxd -r -p | openssl base64 | tr '+/' '-_' | tr -d '='

scp  -i /Users/macmini/github/tipas-keys/ssh-keys/digitalocean_tipas ~/github/android-testdpc/bazel-bin/testdpc-signed.apk root@54.84.79.40:/var/www/html/pfs/pfs-2025.apk


